<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gift EXP</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {background:#0a0a1f; color:#e0e0ff; text-align:center; font-family:sans-serif; padding:15px; margin:0;}
    h1 {color:#ffd700; margin:10px 0; font-size:2.2em; text-shadow:0 0 10px #ffaa00;}
    .stats {font-size:1.3em; margin:15px 0; background:#1a1a3a; padding:10px; border-radius:12px;}
    button {background:#ff3366; color:white; border:none; padding:14px 28px; font-size:1.2em; border-radius:12px; margin:10px 8px; cursor:pointer; box-shadow:0 4px 10px rgba(255,51,102,0.4);}
    button:disabled {background:#555; opacity:0.6;}
    #result {font-size:1.6em; margin:25px 0; min-height:80px; font-weight:bold;}
    .win {color:#00ffaa; animation:blink 1.2s infinite;}
    .lose {color:#ff6666;}
    #exp-bar {margin:20px auto; background:#222; border:2px solid #ffd700; border-radius:12px; height:24px; width:90%; max-width:400px; overflow:hidden;}
    #exp-progress {background:linear-gradient(to right, #ffd700, #ff8800); height:100%; width:0%; transition:width 0.6s;}
    #inventory {margin:20px; background:#1a1a3a; padding:15px; border-radius:12px; display:none;}
    #ref-link {margin:20px; padding:12px; background:#2a2a4a; border-radius:10px; word-break:break-all;}
    @keyframes blink {0%,100% {opacity:1;} 50% {opacity:0.7;}}
  </style>
</head>
<body>
  <h1>Gift EXP</h1>
  
  <div class="stats">
    –ë–∞–ª–∞–Ω—Å Stars: <span id="stars">0</span> ‚òÖ<br>
    EXP: <span id="exp">0</span> | –£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span>
  </div>
  
  <div id="exp-bar"><div id="exp-progress"></div></div>
  
  <p>–í—ã–±–µ—Ä–∏ –∫–µ–π—Å –∏ –∫—Ä—É—Ç–∏!</p>
  
  <button id="btn-stars" onclick="openCase('stars')">Stars Case ‚òÖ (5 ‚òÖ)</button><br>
  <button id="btn-gifts" onclick="openCase('gifts')">Gifts Case üéÅ (10 ‚òÖ)</button><br>
  <button id="btn-nfts" onclick="openCase('nfts')">NFTs Case üñºÔ∏è (15 ‚òÖ)</button>

  <button onclick="claimDailyBonus()" id="daily-btn">–ó–∞–±—Ä–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</button>

  <div id="ref-link">
    –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ –∏ –ø–æ–ª—É—á–∏ +10 ‚òÖ –∑–∞ –∫–∞–∂–¥–æ–≥–æ!<br>
    <strong id="refurl"></strong>
  </div>

  <button onclick="toggleInventory()">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
  <div id="inventory">
    <h3>–¢–≤–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å:</h3>
    <ul id="inv-list"></ul>
  </div>

  <div id="result"></div>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // –î–∞–Ω–Ω—ã–µ
    let stars = parseInt(localStorage.getItem('gift_exp_stars')) || 50; // —Å—Ç–∞—Ä—Ç 50 –¥–ª—è —Ç–µ—Å—Ç–∞
    let exp = parseInt(localStorage.getItem('gift_exp_exp')) || 0;
    let level = Math.floor(exp / 100) + 1;
    let inventory = JSON.parse(localStorage.getItem('gift_exp_inventory')) || [];
    let lastDaily = localStorage.getItem('gift_exp_last_daily') || 0;

    // UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    function updateUI() {
      document.getElementById('stars').innerHTML = stars;
      document.getElementById('exp').innerHTML = exp;
      document.getElementById('level').innerHTML = level;
      let progress = (exp % 100);
      document.getElementById('exp-progress').style.width = progress + '%';

      // –†–µ—Ñ —Å—Å—ã–ª–∫–∞
      const user = Telegram.WebApp.initDataUnsafe.user;
      const refId = user ? user.id : 'testuser';
      document.getElementById('refurl').innerHTML = `t.me/${Telegram.WebApp.initDataUnsafe.bot?.username || '—Ç–≤–æ–π–±–æ—Ç'}?start=ref_${refId}`;

      // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
      const list = document.getElementById('inv-list');
      list.innerHTML = '';
      inventory.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        list.appendChild(li);
      });

      // –ö–Ω–æ–ø–∫–∏ disabled –µ—Å–ª–∏ –º–∞–ª–æ Stars
      document.getElementById('btn-stars').disabled = stars < 5;
      document.getElementById('btn-gifts').disabled = stars < 10;
      document.getElementById('btn-nfts').disabled = stars < 15;

      // Daily –∫–Ω–æ–ø–∫–∞
      const now = Date.now();
      const canClaim = now - lastDaily > 24*60*60*1000;
      document.getElementById('daily-btn').disabled = !canClaim;
      document.getElementById('daily-btn').textContent = canClaim ? "–ó–∞–±—Ä–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å" : "–ï–∂–µ–¥–Ω–µ–≤–∫–∞ —É–∂–µ –≤–∑—è—Ç–∞";

      localStorage.setItem('gift_exp_stars', stars);
      localStorage.setItem('gift_exp_exp', exp);
      localStorage.setItem('gift_exp_inventory', JSON.stringify(inventory));
    }

    updateUI();

    function addExp(amount) {
      exp += amount;
      if (Math.floor(exp / 100) + 1 > level) {
        level = Math.floor(exp / 100) + 1;
        stars += 10 + level * 3; // –±–æ–Ω—É—Å –∑–∞ —É—Ä–æ–≤–µ–Ω—å
        alert(`–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å ${level}! +${10 + level * 3} Stars –±–æ–Ω—É—Å!`);
      }
      updateUI();
    }

    function addStars(amount) {
      stars += amount;
      updateUI();
    }

    function addToInventory(item) {
      inventory.push(item);
      updateUI();
    }

    function openCase(type) {
      let cost = type === 'stars' ? 5 : type === 'gifts' ? 10 : 15;
      if (stars < cost) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Stars! –ö—Ä—É—Ç–∏ —á–∞—â–µ –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π.");
        return;
      }

      stars -= cost;
      document.getElementById('result').innerHTML = '–ö—Ä—É—Ç–∏—Ç—Å—è –∫–µ–π—Å... üî•üé∞üî•';
      updateUI();

      setTimeout(() => {
        const chance = Math.random() * 100;
        let msg = '';
        let cls = 'lose';
        let wonStars = 0;
        let item = '';

        if (type === 'stars') {
          if (chance < 5) { wonStars = 50; msg = `–î–∂–µ–∫–ø–æ—Ç! +${wonStars} Stars!`; cls = 'win'; }
          else if (chance < 25) { wonStars = 15; msg = `+${wonStars} Stars!`; cls = 'win'; }
          else if (chance < 60) { wonStars = 5; msg = `+${wonStars} Stars.`; cls = 'win'; }
          else { msg = '+1 Star... —Å—Ç–∞—Ä–∞–π—Å—è –¥–∞–ª—å—à–µ'; wonStars = 1; cls = 'lose'; }
        } else if (type === 'gifts') {
          if (chance < 3) { item = 'Rare Gift NFT üéÅüëë'; msg = item; cls = 'win'; addStars(25); }
          else if (chance < 20) { item = 'Common Gift üéÅ'; msg = item; cls = 'win'; addStars(8); }
          else { msg = '–ü—É—Å—Ç–æ... –ù–µ—Ç –ø–æ–¥–∞—Ä–∫–∞'; cls = 'lose'; }
        } else if (type === 'nfts') {
          if (chance < 2) { item = 'Legendary TON NFT üñºÔ∏èüî•'; msg = item; cls = 'win'; addStars(40); }
          else if (chance < 15) { item = 'Rare NFT üñºÔ∏è'; msg = item; cls = 'win'; addStars(12); }
          else { msg = '–û–±—ã—á–Ω—ã–π NFT shard...'; cls = 'lose'; }
        }

        if (item) addToInventory(item);

        document.getElementById('result').innerHTML = `<span class="${cls}">${msg}</span>`;
        if (wonStars > 0) addStars(wonStars);
        addExp(10 + Math.floor(wonStars / 3));
      }, 2500);
    }

    function claimDailyBonus() {
      const now = Date.now();
      if (now - lastDaily < 24*60*60*1000) {
        alert("–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å —É–∂–µ –≤–∑—è—Ç. –ü—Ä–∏—Ö–æ–¥–∏ –∑–∞–≤—Ç—Ä–∞!");
        return;
      }

      addStars(20);
      addExp(30);
      lastDaily = now;
      localStorage.setItem('gift_exp_last_daily', lastDaily);
      alert("–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å: +20 Stars –∏ +30 EXP! üî•");
      updateUI();
    }

    function toggleInventory() {
      const inv = document.getElementById('inventory');
      inv.style.display = inv.style.display === 'none' ? 'block' : 'none';
    }
  </script>
</body>
</html>
