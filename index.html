<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gift EXP</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {background:#0d0d1f; color:#d0d0ff; font-family:sans-serif; padding:20px; margin:0;}
    h1 {color:#ffd700; margin:10px;}
    .stats {font-size:18px; margin:15px 0;}
    button {background:#e91e63; color:white; border:none; padding:15px 30px; font-size:20px; border-radius:12px; margin:10px; cursor:pointer;}
    #result {font-size:26px; margin:30px 0; min-height:100px;}
    .win {color:#00ff9d; animation:blink 1.5s infinite;}
    .lose {color:#ff5252;}
    #exp-bar {margin:20px auto; background:#333; border:2px solid #ffd700; border-radius:10px; height:25px; width:80%; max-width:400px;}
    #exp-progress {background:linear-gradient(to right, #ffd700, #ffaa00); height:100%; width:0%; border-radius:8px; transition:width 0.5s;}
    @keyframes blink {0%,100% {opacity:1;} 50% {opacity:0.7;}}
    .gifts-grid {display:grid; grid-template-columns:repeat(auto-fit, minmax(100px, 1fr)); gap:10px; margin:20px 0;}
    .gift-item {text-align:center; background:#1a1a3a; padding:10px; border-radius:12px;}
    .gift-emoji {font-size:40px;}
    .chance {font-size:14px; color:#00ff9d;}
    .price {font-size:14px; color:#ffd700;}
    .bets {display:flex; justify-content:center; gap:20px; margin:20px 0;}
  </style>
</head>
<body>
  <h1>Gift EXP</h1>
  
  <div class="stats">
    –ë–∞–ª–∞–Ω—Å Stars: <span id="stars">0</span> ‚≠ê<br>
    EXP: <span id="exp">0</span> | –£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span>
  </div>
  
  <div id="exp-bar"><div id="exp-progress"></div></div>
  
  <p>–í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É –∏ –∫—Ä—É—Ç–∏!</p>
  
  <div class="bets">
    <button class="bet-btn active" data-bet="25">25 ‚≠ê</button>
    <button class="bet-btn" data-bet="50">50 ‚≠ê</button>
  </div>

  <button class="go-btn" onclick="openCase()">–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç, Go! 25 ‚≠ê</button>

  <div id="reel-container">
    <div id="reel"></div>
    <div class="center-line"></div>
  </div>

  <div id="result"></div>

  <div class="gifts-grid">
    <!-- –®–∞–Ω—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è JS -->
  </div>

  <script>
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    const gifts = [
      {name: 'Diamond', emoji: 'üíé', price: 100},
      {name: 'Trophy', emoji: 'üèÜ', price: 100},
      {name: 'Ring', emoji: 'üíç', price: 100},
      {name: 'Rocket', emoji: 'üöÄ', price: 50},
      {name: 'Champagne', emoji: 'üçæ', price: 50},
      {name: 'Bouquet', emoji: 'üíê', price: 50},
      {name: 'Cake', emoji: 'üéÇ', price: 50},
      {name: 'Rose', emoji: 'üåπ', price: 25},
      {name: 'Gift Box', emoji: 'üéÅ', price: 25},
      {name: 'Teddy', emoji: 'üß∏', price: 15},
      {name: 'Heart', emoji: 'üíù', price: 15}
    ];

    // –®–∞–Ω—Å—ã –¥–ª—è —Å—Ç–∞–≤–∫–∏ 25 –∏ 50 (RTP ~95%)
    const chances = {
      25: {diamond: 0.1, trophy: 0.1, ring: 0.1, rocket: 2, champagne: 2, bouquet: 2, cake: 2, rose: 18, gift: 18, teddy: 27.35, heart: 27.35},
      50: {diamond: 0.2, trophy: 0.2, ring: 0.2, rocket: 4, champagne: 4, bouquet: 4, cake: 4, rose: 16, gift: 16, teddy: 25.6, heart: 25.6}
    };

    let stars = parseInt(localStorage.getItem('gift_exp_stars')) || 0;
    let exp = parseInt(localStorage.getItem('gift_exp_exp')) || 0;
    let level = Math.floor(exp / 100) + 1;
    let currentBet = 25;

    document.getElementById('stars').innerHTML = stars;
    document.getElementById('exp').innerHTML = exp;
    document.getElementById('level').innerHTML = level;
    updateProgress();
    updateChances();

    function updateProgress() {
      let progress = (exp % 100);
      document.getElementById('exp-progress').style.width = progress + '%';
    }

    function updateChances() {
      const grid = document.querySelector('.gifts-grid');
      grid.innerHTML = '';
      gifts.forEach(g => {
        const item = document.createElement('div');
        item.className = 'gift-item';
        item.innerHTML = `
          <div class="gift-emoji">${g.emoji}</div>
          <div class="chance">${chances[currentBet][g.name.toLowerCase()] || 0}%</div>
          <div class="price">${g.price} ‚≠ê</div>
        `;
        grid.appendChild(item);
      });
    }

    document.querySelectorAll('.bet-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentBet = parseInt(btn.dataset.bet);
        document.querySelector('.go-btn').textContent = `–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç, Go! ${currentBet} ‚≠ê`;
        updateChances();
      };
    });

    function addExp(amount) {
      exp += amount;
      localStorage.setItem('gift_exp_exp', exp);
      document.getElementById('exp').innerHTML = exp;
      
      let newLevel = Math.floor(exp / 100) + 1;
      if (newLevel > level) {
        level = newLevel;
        document.getElementById('level').innerHTML = level;
        let bonusStars = 5 + level * 2;
        stars += bonusStars;
        localStorage.setItem('gift_exp_stars', stars);
        document.getElementById('stars').innerHTML = stars;
        alert(`–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å ${level}! –ë–æ–Ω—É—Å: +${bonusStars} Stars! üéâ`);
      }
      updateProgress();
    }

    function openCase() {
      if (stars < currentBet) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Stars!");
        return;
      }

      stars -= currentBet;
      localStorage.setItem('gift_exp_stars', stars);
      document.getElementById('stars').innerHTML = stars;

      const rand = Math.random() * 100;
      let cumChance = 0;
      let selectedGift = gifts[10]; // default
      for (let g of gifts) {
        cumChance += chances[currentBet][g.name.toLowerCase()] || 0;
        if (rand < cumChance) {
          selectedGift = g;
          break;
        }
      }

      stars += selectedGift.price;
      localStorage.setItem('gift_exp_stars', stars);
      document.getElementById('stars').innerHTML = stars;

      addExp(10);

      document.getElementById('result').innerHTML = `<span class="win">${selectedGift.emoji} ${selectedGift.name} +${selectedGift.price} ‚≠ê</span>`;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateChances();
  </script>
</body>
</html>
